{% load leaflet_tags %}
{% load geojson_tags %}

{% leaflet_js %}
{% leaflet_css %}

{% leaflet_map "preview_map" creatediv=False %}
<style>
  .leaflet-container {  /* all maps */
    height: 400px;
  }
</style>
<script type="text/javascript">
    window.addEventListener("map:init", function (e) {
        var detail = e.detail;

        {% if layer.bbox_string %}
        zoom_to_box(detail.map, [{{ layer.bbox_string }}]);
        {% endif %}

        {% if layer.get_tiles_url %}
        L.tileLayer("{{ layer.get_tiles_url|safe }}",{}).addTo(detail.map);
        {% endif %}

        {% if layer.table_name %}
        L.geoJson({{ layer.data_objects|geojsonfeature|safe}}
        ,{
        {% if layer.geom_type == 'Point' %}
            pointToLayer: function(feature, latlng) {
            return new L.CircleMarker(latlng, {radius: 5, fillOpacity: 0.5});
         },
         {% endif %}
        onEachFeature: function (feature, layer) {
            layer.bindPopup('GetFeatureInfo replacement. id: ' + feature.properties.id);
         }
        }
        ).addTo(detail.map);
        {% endif %}

        var geom_type = '{{ layer.geom_type }}';
    }, false);

    function zoom_to_box(map, bbox){
        var bounds = [
            [bbox[1], bbox[0]],
            [bbox[3], bbox[2]]
        ];
        map.fitBounds(bounds);
    }
</script>
